<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
 "http://www.w3.org/TR/html4/loose.dtd">
<!-- Uses "almost standards mode", all but some table cell sizing. -->
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Mathtoys - solve equations</title>
  <script src="pt/js/boilerplate.js"></script>
  <script src="mathtoys.js"></script>
  
<style type="text/css">

/* If the proof editor is not editable, display this. */
.proofEditorContainer .ifReadOnly {
  display: block;
}

.proofEditorContainer.editable .ifReadOnly {
  display: none;
}

#problemArea {
  margin-bottom: 5em;
}

#problemArea button {
  font-size: 80%;
}

#problemArea li {
  margin: .5em 0;
}

#problemArea li span.mathColor {
  display: inline-block;
}
</style>

</head>

<body>

<h1>Mathtoys</h1>

<div id=slogans>
<!-- slogans here -->
</div>

<div class=flex>
<span id=leftNav>
<!-- Boilerplate text goes here -->
</span>

<span id=content>
<h2>Solving equations</h2>

<p>
<b>Problem-solving strategy.</b>
If the equation has just one
variable, one good way to start the solution is to move all terms
containing the variable to the same side of the equation, then
simplify that side and move terms with just numbers to the other side.
<p>
If there are multiple variables, first get one of the equations into
the form <s>v = &hellip; </s>, then <code>replace</code> any
occurrences of it using this equation.  When that is done, solve it as
an equation with a single variable.
<p>
<b>Moving a term.</b>
The simplifier can detect that adding and subtracting the same term
cancel each other out, so you can remove the last term on one side of
an equation by adding or subtracting it from both sides and
simplifying.  You can start by selecting the term.
<p>
<b>Working with your own problems.</b>
With the "general reasoning" menu you can enter your own algebra
problems.  Choose "consider" and enter your formula, using <code>+, -,
*, and /</code> as the names for the basic arithmetic operators.  If
you want to enter "4 times x" be sure to write <code>4 * x</code> and
not <code>4x</code> or <code>4 x</code>.  Also know that Prooftoys is
still learning its algebra too!  It is very limited in what it can do
with fractions and rational functions, though it knows the bare facts.
After entering your assumptions you will probably want to switch the
menus back to algebra mode before starting to work.
<p>
<div id=problemArea>
<h3>Equations to solve</h3>
<ol id=problemList>
</ol>
</div>

<div id=workArea class="hidden proofEditorContainer">
<h3>Problem work area</h3>
<p class=ifReadOnly>
<i><b style="color:red">Note:</b> This display is read-only due to editing
in progress in another window or tab.</i>
</p>
<p>
<div id=proof></div>
</div>

</span> <!-- content -->

</div> <!-- flex -->

<!-- Storage for state to preserve across page unloads -->
<textarea id=ToyStore rows=20 cols=80 class=hidden></textarea>

<script>
// Insert boilerplate.
Toy.insertNav();
Toy.insertSlogans();
Toy.mathifyAll();

// On DOM ready:
$(function() {
    var rules = Toy.rules;
    var $problemList = $('#problemList');
    var editor = new Toy.ProofEditor();
    window.proofEditor = editor;
    editor.setRulesMode('algebra');
    editor.stepEditor.standardSolution = true;

    // For debugging.
    window.dbStep = function(step) {
      proofEditor.proofDisplay.setSteps([]);
      proofEditor.proofDisplay.setSteps(Toy.unrenderedDeps(step));
    };

    $('#proof').append(editor.containerNode);
    // Nudge the editor to set up any parent to reflect
    // its editable state.
    editor.setEditable(editor.isEditable());

    // TODO: Consider using a list of document names rather than
    // a list of lists of wffs to represent a problem set.

    // List of lists of assumptions.
    var problems = [
      ['4 * (2 * x - 3) + 7 = 3 * x + 5'],
      ['8 * (2 - t) = -5 * t'],
      // Textbook examples.  We need user-friendly commands for
      // working with factors in terms before surfacing these.
      // ['x / 2 - 1 = 2 / 3 * x - 3'],
      // ['2 * (a + 3) / 3 = 6 * a + 2'],
      ['x + y = 5', 'x - y = 3'],
      ['5 * x - 22 = y', '2 * y + x = 33'],
      ['x - y = 3', 'y + 5 = x'],
      // ['x = y + 3', 'x + y = 7'],
      ['x = -y - 11', '2 * x - y = 7']
    ];

    let proofVisible = editor.steps.length > 0;

    function swapAreas() {
      $('#problemArea').toggle(300);
      $('#workArea').toggle(300);
      proofVisible = !proofVisible;
      if (!proofVisible) {
        editor.clear();
      }
    }

    if (proofVisible) {
      // Really the proof is not initially visible.
      proofVisible = false;
      // So make it visible now.
      swapAreas();
    }

    function handleTryProblem(event) {
      swapAreas();
      editor.stepEditor.showRules = [];
      editor.setRulesMode('algebra');
      var assumptions = event.data.assumptions;
      var saved = Toy.stepEditor;
      Toy.stepEditor = editor.stepEditor;
      try {
        editor.givens = assumptions;
      } finally {
        Toy.stepEditor = saved;
      }
    };

    function tryOwnProblem() {
      swapAreas();
      editor.stepEditor.showRules = ['given'];
      editor.setRulesMode('algebra');
    }

    function tryExperiments() {
      swapAreas();
      editor.setRulesMode('general');
    }

    // Insert the problems.
    for (var i = 0; i < problems.length; i++) {
      var assumptions = problems[i];
      var markup = $('<span class=mathColor>');
      for (var j = 0; j < assumptions.length; j++) {
        var assumption = assumptions[j];
        var terminator = assumptions.length === 1 ? ' ' : '<br>';
        markup.append(Toy.mathMarkup(assumption), terminator);
      }
      var button = $('<button>Try this problem</button>');
      $problemList.append($('<li>').append(markup, button));

      // Set up event handlers.
      button.on('click', {assumptions: assumptions}, handleTryProblem);
    }
    $problemList.append('<li><button class=ownProblem>' +
                        'Try your own problem</button></li>');
    $problemList.find('.ownProblem').on('click', tryOwnProblem);

    $problemList.append('<li><button class=tryExperiments>' +
                        'Experiment with proofs</button></li>');
    $problemList.find('.tryExperiments').on('click', tryExperiments);

    $('#proof .tryAnother').on('click', swapAreas);

  });

</script>
</body>
</html>
